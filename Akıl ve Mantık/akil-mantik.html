<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForTest Akıl ve Mantık Testi</title>
    <style>
        :root {
            --primary: #60a5fa;
            --primary-dark: #2563eb;
            --secondary: #f43f5e;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #0f172a;
            --gray: #94a3b8;
            --gray-light: #e2e8f0;
            --border-radius: 8px;
            --font-main: 'Segoe UI', Roboto, Arial, sans-serif;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
            
            /* Responsive değişkenler - dikkat testinden alınmış */
            --container-padding: clamp(15px, 4vw, 50px);
            --font-size-base: clamp(14px, 2vw, 18px);
            --font-size-large: clamp(18px, 3vw, 24px);
            --font-size-xlarge: clamp(24px, 4vw, 48px);
            --font-size-xxlarge: clamp(32px, 6vw, 64px);
            --button-padding: clamp(12px, 2vw, 18px) clamp(20px, 4vw, 40px);
            --gap-size: clamp(10px, 2vw, 20px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #1d4ed8 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            font-size: var(--font-size-base);
            margin: 0;
        }

        /* Container 1200x800 aspect ratio - dikkat testinden alınmış */
        .container {
            background: linear-gradient(145deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            border-radius: clamp(15px, 3vw, 20px);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.4),
                0 15px 30px rgba(0, 0, 0, 0.3),
                inset 0 2px 5px rgba(255, 255, 255, 0.1);
            padding: var(--container-padding);
            /* Dynamic sizing: clamp width and maintain 3:2 aspect ratio */
            width: clamp(320px, 90vw, 1200px);
            aspect-ratio: 3 / 2;
            height: auto;
            text-align: center;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            margin: 0 auto;
        }

        /* Loading overlay - dikkat testinden alınmış */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(30, 58, 138, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: var(--font-size-large);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error message - dikkat testinden alınmış */
        .error-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(239, 68, 68, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            flex-direction: column;
            text-align: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .error-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .error-message {
            color: white;
            font-size: var(--font-size-large);
            text-align: center;
            padding: 20px;
            line-height: 1.6;
        }

        .screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: var(--container-padding);
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Örnek gösterim ekranı için özel düzenleme - orijinal yapıyı koru */
        #exampleDemoScreen.active {
            justify-content: center;
            align-items: center;
        }
        
        /* Örnek sorular ekranı için düzenleme - orijinal yapıyı koru */
        #exampleScreen.active {
            justify-content: center;
            align-items: center;
        }

        /* Başlangıç ekranı - dikkat testinden alınmış */
        .title-screen h1 {
            font-size: var(--font-size-xxlarge);
            color: white;
            font-weight: 700;
            margin-bottom: clamp(25px, 6vw, 50px);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
        }

        .instruction-box {
            background: transparent;
            border-radius: 0;
            padding: clamp(10px, 3vw, 20px);
            margin: clamp(15px, 4vw, 30px) auto;
            max-width: min(90%, 800px);
            box-shadow: none;
            border: none;
        }

        .instruction-text {
            font-size: var(--font-size-large);
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: clamp(10px, 3vw, 20px);
            line-height: 1.8;
        }

        .highlight-text {
            color: white;
            font-weight: bold;
            font-size: clamp(20px, 3.5vw, 28px);
            margin: clamp(10px, 3vw, 20px) 0;
            line-height: 1.8;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .btn {
            display: inline-block;
            font-weight: 500;
            color: white;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            padding: var(--button-padding);
            font-size: clamp(16px, 2.5vw, 22px);
            line-height: 1.5;
            border-radius: var(--border-radius);
            transition: opacity 0.5s ease, transform 0.5s ease, background 0.3s ease, box-shadow 0.3s ease;
            border: none;
            box-shadow: 
                0 4px 6px rgba(30, 64, 175, 0.3),
                0 0 15px rgba(255, 255, 255, 0.3),
                0 0 25px rgba(255, 255, 255, 0.1);
            text-decoration: none;
            margin: clamp(5px, 1vw, 10px);
            opacity: 0;
            transform: translateY(20px);
            min-width: clamp(100px, 20vw, 150px);
            position: relative;
            overflow: hidden;
            min-height: clamp(44px, 8vw, 56px);
        }

        .btn.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .btn:hover:not(.disabled) {
            background: linear-gradient(135deg, #1e3d9f 0%, #2454d6 100%);
            box-shadow: 
                0 6px 8px rgba(30, 58, 138, 0.4),
                0 0 20px rgba(255, 255, 255, 0.4),
                0 0 35px rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .btn-bottom-right {
            position: absolute;
            bottom: clamp(20px, 4vw, 40px);
            right: clamp(20px, 4vw, 40px);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .btn-bottom-right.visible {
            opacity: 1;
        }

        /* Sonuç ekranı - dikkat testinden alınmış */
        .result-message {
            font-size: clamp(28px, 5vw, 48px);
            color: white;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: clamp(15px, 4vw, 30px);
            line-height: 1.2;
        }

        .result-info {
            font-size: var(--font-size-large);
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        /* Test alanı */
        .test-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
            padding: 20px;
        }

        #exampleDemoScreen .test-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
            padding: 10px;
        }
        
        #exampleScreen .test-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
            padding: 10px;
        }

        /* Soru gösterimi */
        .question-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-bottom: 30px;
        }

        .question-image {
            width: 600px;
            height: 300px;
            object-fit: contain;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            background: #f9fafb;
            padding: 15px;
            image-rendering: auto;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        #exampleDemoScreen .question-image {
            width: clamp(400px, 60vw, 500px);
            height: clamp(200px, 30vw, 250px);
            object-fit: contain;
            margin-bottom: 15px;
        }
        
        #exampleScreen .question-image {
            width: clamp(400px, 60vw, 500px);
            height: clamp(200px, 30vw, 250px);
            object-fit: contain;
            margin-bottom: 20px;
        }

        #exampleDemoScreen .question-display {
            margin-bottom: 10px;
        }

        /* Seçenekler - Tüm sorular için tek düzen */
        .options-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: nowrap;
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 10px;
        }

        #exampleDemoScreen .options-container {
            gap: clamp(8px, 2vw, 12px);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 0 5px;
            max-width: 100%;
        }

        #exampleScreen .options-container {
            gap: clamp(8px, 2vw, 12px);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 0 5px;
            max-width: 100%;
        }

        .option {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            background: #ffffff;
            padding: 10px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex: 0 0 auto;
            width: 135px;
        }

        #exampleDemoScreen .option {
            padding: 8px;
            width: clamp(100px, 15vw, 120px);
        }
        
        .option-label {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--primary-dark);
            background: #e8f4fd;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1;
        }

        #exampleDemoScreen .option-label {
            width: clamp(30px, 5vw, 35px);
            height: clamp(30px, 5vw, 35px);
            font-size: clamp(14px, 2.5vw, 18px);
        }
        

        
        .option.selected {
            background: linear-gradient(135deg, #90cdf4 0%, #60a5fa 100%) !important;
            color: black !important;
            border-color: #90cdf4 !important;
            box-shadow: 
                0 clamp(2px, 0.5vw, 4px) clamp(4px, 1vw, 6px) rgba(0, 0, 0, 0.2),
                0 1px 3px rgba(0, 0, 0, 0.15),
                inset 0 2px 2px rgba(255, 255, 255, 0.8) !important;
        }
        
        .option.selected .option-label {
            background: linear-gradient(135deg, #90cdf4 0%, #60a5fa 100%) !important;
            color: black !important;
            box-shadow: 
                0 clamp(2px, 0.5vw, 4px) clamp(4px, 1vw, 6px) rgba(0, 0, 0, 0.2),
                0 1px 3px rgba(0, 0, 0, 0.15),
                inset 0 2px 2px rgba(255, 255, 255, 0.8) !important;
        }

        .option img {
            width: 110px;
            height: 110px;
            object-fit: contain;
            display: block;
            border-radius: 8px;
            background: #f8f9fa;
            padding: 5px;
        }

        #exampleDemoScreen .option img {
            width: clamp(80px, 12vw, 100px);
            height: clamp(80px, 12vw, 100px);
        }

        .option.correct {
            border-color: #10b981;
            background: #ecfdf5;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }
        
        .option.correct .option-label {
            background: #10b981;
            color: white;
        }

        .option.wrong {
            border-color: #ef4444;
            background: #fef2f2;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }
        
        .option.wrong .option-label {
            background: #ef4444;
            color: white;
        }

        /* DİSABLED kuralı EN SONDA olmalı - diğer kuralları ezsin */
        .option.disabled {
            opacity: 0.6 !important;
            cursor: not-allowed !important;
            pointer-events: none !important;
            transform: none !important;
        }

        .option.disabled:hover {
            background: initial !important;
            border-color: initial !important;
            transform: none !important;
            box-shadow: initial !important;
        }

        /* Program gösterimi için animasyon */
        .demo-pointer {
            position: absolute;
            width: 20px;
            height: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path d="M0,0 L0,16 L4,12 L7,19 L10,18 L7,11 L12,11 Z" fill="black" stroke="white" stroke-width="1"/></svg>');
            background-size: contain;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
        }

        /* Tıklama efekti */
        .click-effect {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 3px solid #10b981;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
            z-index: 1001;
        }

        .click-effect::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid #10b981;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: inherit;
        }
        
        .click-effect.active {
            animation: clickRipple 1s ease-out forwards;
        }
        
        .click-effect.active::before {
            animation: innerRipple 1s ease-out forwards;
        }

        @keyframes clickRipple {
            0% {
                opacity: 0.8;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1.5);
            }
            100% {
                opacity: 0;
                transform: scale(2.5);
            }
        }

        @keyframes innerRipple {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.3);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.5);
            }
        }

        /* Progress bar için animasyon */
        @keyframes fillProgress {
            from {
                width: 0%;
            }
            to {
                width: 100%;
            }
        }
        
        .progress-fill.animating {
            animation: fillProgress 300s linear forwards; /* 5 dakika = 300 saniye */
        }

        /* İlerleme göstergesi */
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: clamp(6px, 1vw, 8px);
            background: rgba(255, 255, 255, 0.2);
            overflow: hidden;
            border-bottom-left-radius: clamp(15px, 3vw, 20px);
            border-bottom-right-radius: clamp(15px, 3vw, 20px);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%);
            width: 0%;
            position: relative;
            border-bottom-left-radius: clamp(15px, 3vw, 20px);
            border-bottom-right-radius: clamp(15px, 3vw, 20px);
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 60px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-50px); }
            100% { transform: translateX(50px); }
        }

        /* Memory text - hafıza testinden alınmış */
        .memory-text {
            font-size: clamp(16px, 2.5vw, 22px);
            color: white;
            font-weight: 500;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            position: absolute;
            bottom: clamp(20px, 4vw, 40px);
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
            width: max-content;
            max-width: 80%;
            padding: clamp(12px, 2vw, 18px) clamp(20px, 4vw, 40px);
            background: rgba(30, 64, 175, 0.8);
            backdrop-filter: blur(8px);
            border-radius: var(--border-radius);
            line-height: 1.5;
            margin: clamp(5px, 1vw, 10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .notification {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 20px 30px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: var(--font-size-base);
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: var(--danger);
        }

        .notification.show {
            opacity: 1;
        }

        /* Responsive Media Queries - dikkat testinden alınmış */
        
        /* Çok küçük telefon ekranları */
        @media (max-width: 360px) {
            .container {
                padding: clamp(10px, 3vw, 15px);
            }
            
            #exampleDemoScreen .options-container {
                gap: 12px;
            }
            
            #exampleDemoScreen .option img {
                width: 90px;
                height: 90px;
            }
        }

        /* Küçük telefon ekranları */
        @media (max-width: 480px) {
            .btn-bottom-right {
                position: relative;
                bottom: auto;
                right: auto;
                margin-top: 20px;
            }
            
            .options-container {
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .option {
                width: 110px;
                padding: 8px;
            }
            
            .option img {
                width: 85px;
                height: 85px;
            }
            
            .option-label {
                width: 35px;
                height: 35px;
                font-size: 1.1em;
            }
        }

        /* Tablet ve masaüstü */
        @media (min-width: 481px) {
            .container {
                height: min(100vh - 30px, 800px);
            }
        }

        /* Büyük ekranlar */
        @media (min-width: 1400px) {
            .container {
                width: min(90%, 1400px);
                height: min(100vh - 40px, 900px);
            }
        }

        /* Landscape mode mobil */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                height: 95vh;
                padding: 15px;
            }
            .title-screen h1 {
                margin-bottom: 20px;
            }
            .instruction-box {
                padding: 20px;
                margin: 15px auto;
            }
        }

        /* High DPI ekranlar için font optimizasyonu */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .title-screen h1, .result-message {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .loading-overlay, .error-overlay {
                transition: opacity 0.1s ease !important;
            }
        }

        /* Geri sayım ekranı - çok sade */
        .countdown-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .countdown-number {
            font-size: clamp(80px, 12vw, 150px);
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .option {
                border-width: 2px;
                border-color: black;
            }
            .btn {
                border: 2px solid white;
            }
        }

        @media (max-width: 1300px) {
            .container {
                width: 95%;
                max-width: 1280px;
            }
            
            #exampleDemoScreen .options-container {
                gap: 12px;
            }
            
            #exampleDemoScreen .option img {
                width: 90px;
                height: 90px;
            }
        }

        @media (max-width: 1100px) {
            .options-container {
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .option {
                width: 130px;
            }
            
            .option img {
                width: 100px;
                height: 100px;
            }
        }
        
        @media (max-width: 900px) {
            .question-image {
                width: 500px;
                height: 250px;
            }
            
            .options-container {
                gap: 8px;
                max-width: 100%;
            }
            
            .option {
                width: 110px;
                padding: 8px;
            }
            
            .option img {
                width: 85px;
                height: 85px;
            }
            
            .option-label {
                width: 35px;
                height: 35px;
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                height: 95vh;
                min-height: 650px;
                padding: 30px 20px;
            }
            
            #exampleDemoScreen.active {
                justify-content: center;
                align-items: center;
            }
            
            #exampleDemoScreen .question-image {
                width: clamp(300px, 80vw, 400px);
                height: clamp(150px, 40vw, 200px);
            }
            
            #exampleDemoScreen .option img {
                width: clamp(60px, 12vw, 80px);
                height: clamp(60px, 12vw, 80px);
            }
            
            #exampleDemoScreen .options-container {
                gap: 10px;
            }
            
            #exampleScreen .question-image {
                width: clamp(300px, 80vw, 400px);
                height: clamp(150px, 40vw, 200px);
                margin-bottom: 10px;
            }
            
            #exampleScreen .options-container {
                gap: 8px;
            }

            .title-screen h1 {
                font-size: 3em;
            }

            .question-image {
                width: 100%;
                max-width: 400px;
                height: 200px;
            }
            
            .options-container {
                gap: 6px;
                padding: 0 5px;
            }
            
            .option {
                width: 90px;
                padding: 6px;
            }

            .option img {
                width: 70px;
                height: 70px;
                padding: 3px;
            }
            
            .option-label {
                width: 30px;
                height: 30px;
                font-size: 1em;
            }

            .result-message {
                font-size: 2.5em;
            }
        }
        
        @media (max-width: 480px) {
            .options-container {
                gap: 4px;
            }
            
            .option {
                width: 70px;
                padding: 4px;
                gap: 5px;
            }
            
            .option img {
                width: 55px;
                height: 55px;
                padding: 2px;
            }
            
            .option-label {
                width: 26px;
                height: 26px;
                font-size: 0.85em;
            }

            .instruction-text {
                font-size: 1.2em;
            }

            .highlight-text {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Yükleniyor...</div>
        </div>

        <!-- Error Overlay -->
        <div class="error-overlay" id="errorOverlay">
            <div class="error-message" id="errorMessage">Bir hata oluştu</div>
        </div>

        <!-- 0. Başlangıç Title Ekranı -->
        <div id="titleScreen" class="screen active">
            <div class="title-screen">
                <h1>Akıl ve Mantık Testi</h1>
            </div>
            <button class="btn btn-bottom-right visible" onclick="stopCurrentAudio(); goToWelcome()">İleri</button>
        </div>

        <!-- 1. Giriş Ekranı -->
        <div id="welcomeScreen" class="screen">
            <div class="instruction-box">
                <div class="highlight-text">
                    Örüntüyü Tamamlayan Seçeneği İşaretle
                </div>
            </div>
            <button class="btn btn-bottom-right" id="welcomeNextBtn" onclick="stopCurrentAudio(); goToExampleDemo()">İleri</button>
        </div>

        <!-- 2. Örnek Gösterim Ekranı -->
        <div id="exampleDemoScreen" class="screen">
            <div class="test-area" id="demoArea">
                <!-- Program örneği gösterecek -->
            </div>
            <div class="memory-text">Örneği Dikkatle İzleyin!</div>
            <button class="btn btn-bottom-right" id="demoNextBtn" onclick="stopCurrentAudio(); goToExampleIntro()" style="display: none;">İleri</button>
        </div>

        <!-- 3. Örnek Uygulama Giriş Ekranı -->
        <div id="exampleIntroScreen" class="screen">
            <div class="instruction-box">
                <div class="highlight-text">
                    Örnek Uygulamaya Geçmek İçin "İleri" Butonuna Tıklayın!
                </div>
            </div>
            <button class="btn btn-bottom-right" id="exampleIntroNextBtn" onclick="stopCurrentAudio(); goToExampleReady()">İleri</button>
        </div>

        <!-- 4. Örnek Hazır Ekranı -->
        <div id="exampleReadyScreen" class="screen">
            <div class="instruction-box">
                <div class="highlight-text">
                    Örnek Uygulamaya Hazırsanız "Başla" Butonuna Tıklayın!
                </div>
            </div>
            <button class="btn btn-bottom-right" id="exampleReadyBtn" onclick="stopCurrentAudio(); showExampleCountdown()">Başla</button>
        </div>

        <!-- 5. Örnek Uygulama Geri Sayım Ekranı -->
        <div id="exampleCountdownScreen" class="screen">
            <div class="countdown-screen">
                <div id="exampleCountdownNumber" class="countdown-number">3</div>
            </div>
        </div>

        <!-- 6. Örnek Sorular Ekranı -->
        <div id="exampleScreen" class="screen">
            <div class="test-area">
                <div class="question-display">
                    <img id="exampleQuestionImg" class="question-image" src="" alt="Örnek soru">
                </div>
                <div class="options-container" id="exampleOptions">
                    <!-- Dinamik olarak doldurulacak -->
                </div>
            </div>
        </div>

        <!-- 7. Örnek Bitiş Ekranı -->
        <div id="exampleCompleteScreen" class="screen">
            <div class="instruction-box">
                <div class="highlight-text">
                    Örnek Uygulamayı Tamamladınız!
                </div>
            </div>
            <button class="btn btn-bottom-right" id="exampleCompleteBtn" onclick="stopCurrentAudio(); goToMainTestIntro()">İleri</button>
        </div>

        <!-- 8. Ana Test Giriş Ekranı -->
        <div id="mainTestIntroScreen" class="screen">
            <div class="instruction-box">
                <div class="highlight-text">
                    Teste Hazırlanın!<br>
                    Testi Tamamlamak için 5 Dakikanız Var.
                </div>
            </div>
            <button class="btn btn-bottom-right" id="mainTestStartBtn" onclick="stopCurrentAudio(); showMainCountdown()">Başla</button>
        </div>

        <!-- 8. Ana Test Geri Sayım Ekranı -->
        <div id="mainCountdownScreen" class="screen">
            <div class="countdown-screen">
                <div id="mainCountdownNumber" class="countdown-number">3</div>
            </div>
        </div>

        <!-- 9. Ana Test Ekranı -->
        <div id="mainTestScreen" class="screen">
            <div class="test-area">
                <div class="question-display">
                    <img id="mainQuestionImg" class="question-image" src="" alt="Test sorusu">
                </div>
                <div class="options-container" id="mainOptions">
                    <!-- Dinamik olarak doldurulacak -->
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="timeProgressFill"></div>
            </div>
        </div>

        <!-- 10. Örnek Uygulama Başarısızlık Ekranı -->
        <div id="exampleFailScreen" class="screen">
            <div class="instruction-box">
                <div class="highlight-text">
                    Yeterli doğru cevabı vermediniz, örnek uygulama tekrar edilecektir.
                </div>
            </div>
            <button class="btn btn-bottom-right visible" onclick="retryExampleFromFail()">Tamam</button>
        </div>

        <!-- 11. Sonuç Ekranı -->
        <div id="resultsScreen" class="screen">
            <div class="result-message">Tüm Testi Tamamladınız!</div>
            <div class="result-info">Sıradaki Bölüme Geçmek İçin İleri Butonuna Tıklayın!</div>
            <button class="btn btn-bottom-right visible" onclick="stopCurrentAudio(); completeTest()">İleri</button>
        </div>
    </div>

    <!-- Demo pointer for example -->
    <div class="demo-pointer" id="demoPointer"></div>
    
    <!-- Tıklama efekti -->
    <div class="click-effect" id="clickEffect"></div>

    <script>
        // ===================================
        // AKIL VE MANTIK TESTİ SİSTEMİ - v2.1 CLEAN
        // Dikkat Testi Yapısında Adapte Edilmiş
        // ===================================

        'use strict';

        // Global hata yakalama - dikkat testinden alınmış
        window.addEventListener('error', function(e) {
            console.error('Global Error:', e.error);
            handleError('Beklenmeyen bir hata oluştu: ' + e.message, true);
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled Promise Rejection:', e.reason);
            handleError('Promise hatası: ' + e.reason, true);
        });

        // Hata yönetimi - dikkat testinden alınmış
        function handleError(message, critical = false) {
            console.error('Test Error:', message);
            hideLoading();

            if (critical) {
                showError(message, 6000);
            } else {
                console.warn('Non-critical error handled:', message);
            }
        }

        // Loading göstergesi - dikkat testinden alınmış
        let loadingTimeout = null;
        
        function showLoading(message = 'Yükleniyor...', minDisplayTime = 500) {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            
            if (overlay) {
                if (text) text.textContent = message;
                if (loadingTimeout) {
                    clearTimeout(loadingTimeout);
                    loadingTimeout = null;
                }
                overlay.classList.add('show');
            }
        }

        function hideLoading(delay = 0) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                if (delay > 0) {
                    loadingTimeout = setTimeout(() => {
                        overlay.classList.remove('show');
                        loadingTimeout = null;
                    }, delay);
                } else {
                    overlay.classList.remove('show');
                }
            }
        }

        // Error overlay - dikkat testinden alınmış
        let errorTimeout = null;

        function showError(message, duration = 4000) {
            const overlay = document.getElementById('errorOverlay');
            const messageEl = document.getElementById('errorMessage');
            
            if (overlay) {
                if (messageEl) messageEl.textContent = message;
                overlay.classList.add('show');
                
                if (errorTimeout) {
                    clearTimeout(errorTimeout);
                }
                
                errorTimeout = setTimeout(() => {
                    hideError();
                }, duration);
            }
        }

        function hideError() {
            const overlay = document.getElementById('errorOverlay');
            if (overlay) {
                overlay.classList.remove('show');
                if (errorTimeout) {
                    clearTimeout(errorTimeout);
                    errorTimeout = null;
                }
            }
        }

        // ==================== TEST VERİLERİ ====================
        const testData = {
            // Örnek sorular - 4 adet (1'i program gösterecek, 3'ü kullanıcı yapacak)
            examples: [
                {
                    folder: 'ÖRÜNTÜLER /1-ÖRNEK UYGULAMA/ÖRNEK UYGULAMA-1',
                    correctAnswer: 2 // 3-DOĞRU
                },
                {
                    folder: 'ÖRÜNTÜLER /1-ÖRNEK UYGULAMA/ÖRNEK UYGULAMA-2',
                    correctAnswer: 3 // 4-DOĞRU
                },
                {
                    folder: 'ÖRÜNTÜLER /1-ÖRNEK UYGULAMA/ÖRNEK UYGULAMA-3',
                    correctAnswer: 1 // 2-DOĞRU
                },
                {
                    folder: 'ÖRÜNTÜLER /1-ÖRNEK UYGULAMA/ÖRNEK UYGULAMA-4',
                    correctAnswer: 1 // 2-DOĞRU
                }
            ],
            
            // Ana test soruları
            mainQuestions: [
                // BÖLÜM 1 - Dörtlü Yatay Format (8 soru)
                { folder: 'ÖRÜNTÜLER /2-DÖRTLÜ YATAY/1', correctAnswer: 1, section: 1 }, // 2-DOĞRU
                { folder: 'ÖRÜNTÜLER /2-DÖRTLÜ YATAY/2', correctAnswer: 4, section: 1 }, // 5-DOĞRU
                { folder: 'ÖRÜNTÜLER /2-DÖRTLÜ YATAY/3', correctAnswer: 3, section: 1 }, // 4-DOĞRU
                { folder: 'ÖRÜNTÜLER /2-DÖRTLÜ YATAY/4', correctAnswer: 4, section: 1 }, // 5-DOĞRU
                { folder: 'ÖRÜNTÜLER /2-DÖRTLÜ YATAY/5', correctAnswer: 3, section: 1 }, // 4-DOĞRU
                { folder: 'ÖRÜNTÜLER /2-DÖRTLÜ YATAY/6', correctAnswer: 1, section: 1 }, // 2-DOĞRU
                { folder: 'ÖRÜNTÜLER /2-DÖRTLÜ YATAY/7', correctAnswer: 2, section: 1 }, // 3-DOGRU
                { folder: 'ÖRÜNTÜLER /2-DÖRTLÜ YATAY/8', correctAnswer: 1, section: 1 }, // 2-DOGRU
                
                // BÖLÜM 2 - Dörtlü Kare Format (6 soru) 
                { folder: 'ÖRÜNTÜLER /3-DÖRTLÜ KARE FORMAT/1', correctAnswer: 3, section: 2 }, // 4-DOĞRU
                { folder: 'ÖRÜNTÜLER /3-DÖRTLÜ KARE FORMAT/2', correctAnswer: 2, section: 2 }, // 3-DOĞRU
                { folder: 'ÖRÜNTÜLER /3-DÖRTLÜ KARE FORMAT/3', correctAnswer: 3, section: 2 }, // 4-DOĞRU
                { folder: 'ÖRÜNTÜLER /3-DÖRTLÜ KARE FORMAT/4', correctAnswer: 1, section: 2 }, // 2-DOĞRU
                { folder: 'ÖRÜNTÜLER /3-DÖRTLÜ KARE FORMAT/5', correctAnswer: 2, section: 2 }, // 3-DOĞRU
                { folder: 'ÖRÜNTÜLER /3-DÖRTLÜ KARE FORMAT/6', correctAnswer: 3, section: 2 }, // 4-DOĞRU
                
                // BÖLÜM 3 - Altılı Kare Format (3 soru)
                { folder: 'ÖRÜNTÜLER /4-ALTILI KARE FORMAT/1', correctAnswer: 5, section: 3 }, // 6-DOGRU
                { folder: 'ÖRÜNTÜLER /4-ALTILI KARE FORMAT/2', correctAnswer: 0, section: 3 }, // 1-DOGRU
                { folder: 'ÖRÜNTÜLER /4-ALTILI KARE FORMAT/3', correctAnswer: 2, section: 3 }, // 3-DOGRU
                
                // BÖLÜM 4 - L Format (3 soru)
                // Not: Görsel dosyalar henüz yok, placeholder olarak kullanılacak
                { folder: 'ÖRÜNTÜLER /5- L FORMAT/1', correctAnswer: 4, section: 4 }, // 5-DOGRU
                { folder: 'ÖRÜNTÜLER /5- L FORMAT/2', correctAnswer: 2, section: 4 }, // 3-DOGRU
                { folder: 'ÖRÜNTÜLER /5- L FORMAT/3', correctAnswer: 2, section: 4 }, // 3-DOGRU
                
                // BÖLÜM 5 - Dokuzlu Format (3 soru)
                { folder: 'ÖRÜNTÜLER /6-DOKUZLU FORMAT/1', correctAnswer: 2, section: 5 }, // 3-DOGRU
                { folder: 'ÖRÜNTÜLER /6-DOKUZLU FORMAT/2', correctAnswer: 3, section: 5 }, // 4-DOGRU
                { folder: 'ÖRÜNTÜLER /6-DOKUZLU FORMAT/3', correctAnswer: 0, section: 5 }  // 1-DOGRU
            ],
            
            // Bölüm adları
            sectionNames: {
                1: "Dörtlü Yatay Format",
                2: "Dörtlü Kare Format", 
                3: "Altılı Kare Format",
                4: "L Format",
                5: "Dokuzlu Format"
            },
            
            // Ses dosyaları (şimdilik placeholder)
            audioFiles: {
                welcome: 'akil_mantik_giris.mp3',
                exampleDemo: 'akil_mantik_ornek_gosterim.mp3',
                exampleIntro: 'akil_mantik_ornek_gecis.mp3',
                exampleReady: 'akil_mantik_ornek_hazir.mp3',
                exampleComplete: 'akil_mantik_ornek_bitis.mp3',
                mainTestIntro: 'akil_mantik_test_giris.mp3',
                testComplete: 'akil_mantik_test_bitis.mp3'
            }
        };

        // ==================== DURUM YÖNETİMİ ====================
        let testState = {
            currentScreen: 'title',
            currentAudio: null,
            currentExampleIndex: 0,
            exampleAttempts: 0,
            exampleCorrectCount: 0,
            currentQuestionIndex: 0,
            testStartTime: null,
            questionStartTime: null,
            sectionStartTimes: {},
            totalTimeLimit: 300, // 5 dakika
            remainingTime: 300,
            timerInterval: null,
            answers: [],
            sectionResults: {
                1: { correct: 0, total: 8, time: 0 },
                2: { correct: 0, total: 6, time: 0 },
                3: { correct: 0, total: 3, time: 0 },
                4: { correct: 0, total: 3, time: 0 },
                5: { correct: 0, total: 3, time: 0 }
            },
            locked: false,
            isTransitioning: false
        };

        // Debouncing utility - çift tıklama önleme
        const debounce = (func, wait) => {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        };

        // State lock/unlock fonksiyonları
        function lockState() {
            testState.locked = true;
        }

        function unlockState() {
            testState.locked = false;
        }

        function safeLock() {
            if (testState.locked) {
                console.warn('State already locked, ignoring operation');
                return false;
            }
            lockState();
            return true;
        }

        // ==================== SES YÖNETİMİ ====================
        function playAudio(filename, callback) {
            // Önceki sesi tamamen durdur ve temizle
            if (testState.currentAudio) {
                testState.currentAudio.pause();
                testState.currentAudio.currentTime = 0;
                testState.currentAudio.onended = null;
                testState.currentAudio.onerror = null;
                testState.currentAudio = null;
            }
            
            const audio = new Audio(`./mp3/${filename}`);
            testState.currentAudio = audio;
            
            console.log('Ses dosyası çalınıyor:', filename);
            
            audio.addEventListener('ended', () => {
                console.log('Ses dosyası bitti:', filename);
                testState.currentAudio = null;
                if (callback) callback();
            });
            
            audio.addEventListener('error', (e) => {
                console.error('Ses dosyası yüklenemedi:', filename, e);
                testState.currentAudio = null;
                if (callback) callback();
            });
            
            audio.play().catch(error => {
                console.log('Ses çalma hatası:', error);
                testState.currentAudio = null;
                if (callback) callback();
            });
        }

        function stopCurrentAudio() {
            if (testState.currentAudio) {
                testState.currentAudio.pause();
                testState.currentAudio.currentTime = 0;
                testState.currentAudio.onended = null;
                testState.currentAudio.onerror = null;
                testState.currentAudio = null;
            }
        }

        // ==================== EKRAN YÖNETİMİ ====================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            testState.currentScreen = screenId;
        }

        function showButton(buttonId) {
            setTimeout(() => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.classList.add('visible');
                }
            }, 100);
        }

        // ==================== GİRİŞ EKRANLARI ====================
        function goToWelcome() {
            stopCurrentAudio(); // Önceki sesi durdur
            showScreen('welcomeScreen');
            playAudio(testData.audioFiles.welcome, () => {
                showButton('welcomeNextBtn');
            });
        }

        function goToExampleDemo() {
            stopCurrentAudio(); // Önceki sesi durdur
            showScreen('exampleDemoScreen');
            
            // Ses çalarken örneği göster
            playAudio(testData.audioFiles.exampleDemo);
            
            // Hemen örnek gösterimini başlat
            setTimeout(showProgramDemo, 500);
        }

        // Program örnek gösterimi
        function showProgramDemo() {
            const demoArea = document.getElementById('demoArea');
            
            const example = testData.examples[0];
            const basePath = `./${example.folder}`;
            
            // Soru ve seçenekleri göster
            demoArea.innerHTML = `
                <div class="question-display">
                    <img class="question-image" src="${basePath}/soru.png" alt="Örnek soru">
                </div>
                <div class="options-container" id="demoOptions">
                    ${generateOptions(basePath, 'demo')}
                </div>
            `;
            
            // 2 saniye sonra mouse animasyonunu başlat
            setTimeout(() => {
                const pointer = document.getElementById('demoPointer');
                const clickEffect = document.getElementById('clickEffect');
                const correctOption = document.querySelectorAll('#demoOptions .option')[example.correctAnswer];
                
                if (correctOption) {
                    const rect = correctOption.getBoundingClientRect();
                    const targetX = rect.left + rect.width / 2;
                    const targetY = rect.top + rect.height / 2;
                    
                    // Mouse'u sağ üstten başlat (daha doğal görünüm için)
                    pointer.style.left = (window.innerWidth * 0.7) + 'px';
                    pointer.style.top = (window.innerHeight * 0.3) + 'px';
                    pointer.style.opacity = '1';
                    
                    // Mouse'u hedefe doğru hareket ettir
                    pointer.style.transition = 'left 1.5s ease-in-out, top 1.5s ease-in-out';
                    
                    setTimeout(() => {
                        pointer.style.left = (targetX - 10) + 'px'; // Mouse cursor SVG offset
                        pointer.style.top = (targetY - 10) + 'px';
                    }, 100);
                    
                    // 1.5 saniye sonra hover efekti ekle
                    setTimeout(() => {
                        correctOption.style.transition = 'all 0.3s ease';
                        correctOption.style.border = '3px solid #60a5fa';
                        correctOption.style.transform = 'scale(1.05)';
                        correctOption.style.boxShadow = '0 4px 15px rgba(59, 130, 246, 0.3)';
                    }, 1600);
                    
                    // 2 saniye sonra tıklama efekti ve seçim
                    setTimeout(() => {
                        // Tıklama efekti
                        clickEffect.style.left = (targetX - 15) + 'px';
                        clickEffect.style.top = (targetY - 15) + 'px';
                        clickEffect.classList.add('active');
                        
                        // Seçimi yap
                        correctOption.classList.add('correct');
                        
                        // Mouse'u gizle ve efektleri temizle
                        setTimeout(() => {
                            pointer.style.opacity = '0';
                            
                            // Click efektini ve pointer'ı temizle
                            setTimeout(() => {
                                clickEffect.classList.remove('active');
                                clickEffect.style.left = '';
                                clickEffect.style.top = '';
                                
                                // Pointer'ı sıfırla
                                pointer.style.transition = '';
                                pointer.style.left = '';
                                pointer.style.top = '';
                            }, 1000);
                            
                            // Demo bitince ileri butonunu göster
                            setTimeout(() => {
                                const demoBtn = document.getElementById('demoNextBtn');
                                demoBtn.style.display = 'block';
                                setTimeout(() => {
                                    demoBtn.classList.add('visible');
                                }, 100);
                            }, 1000);
                        }, 1000);
                    }, 2000);
                }
            }, 2000);
        }

        function goToExampleIntro() {
            stopCurrentAudio(); // Önceki sesi durdur
            
            // Demo butonunu gizle
            const demoBtn = document.getElementById('demoNextBtn');
            if (demoBtn) {
                demoBtn.style.display = 'none';
                demoBtn.classList.remove('visible');
            }
            
            // Demo ekranını temizle
            const demoOptions = document.querySelectorAll('#demoOptions .option');
            demoOptions.forEach(option => {
                option.style.transition = '';
                option.style.border = '';
                option.style.transform = '';
                option.style.boxShadow = '';
            });
            
            showScreen('exampleIntroScreen');
            playAudio(testData.audioFiles.exampleIntro, () => {
                showButton('exampleIntroNextBtn');
            });
        }

        function goToExampleReady() {
            stopCurrentAudio(); // Önceki sesi durdur
            showScreen('exampleReadyScreen');
            playAudio(testData.audioFiles.exampleReady, () => {
                showButton('exampleReadyBtn');
            });
        }

        // ==================== GERİ SAYIM EKRANLARI ====================
        function showExampleCountdown() {
            if (testState.isTransitioning) {
                console.warn('Countdown ignored - already transitioning');
                return;
            }
            testState.isTransitioning = true;
            
            stopCurrentAudio();
            showScreen('exampleCountdownScreen');
            
            const numberEl = document.getElementById('exampleCountdownNumber');
            if (!numberEl) {
                startExampleSection();
                return;
            }
            
            let count = 3;
            numberEl.textContent = count;
            
            const countdownInterval = setInterval(() => {
                count--;
                
                if (count > 0) {
                    numberEl.textContent = count;
                } else {
                    clearInterval(countdownInterval);
                    testState.isTransitioning = false;
                    startExampleSection();
                }
            }, 1000);
        }

        function showMainCountdown() {
            if (testState.isTransitioning) {
                console.warn('Main countdown ignored - already transitioning');
                return;
            }
            testState.isTransitioning = true;
            
            stopCurrentAudio();
            showScreen('mainCountdownScreen');
            
            const numberEl = document.getElementById('mainCountdownNumber');
            if (!numberEl) {
                startMainTest();
                return;
            }
            
            let count = 3;
            numberEl.textContent = count;
            
            const countdownInterval = setInterval(() => {
                count--;
                
                if (count > 0) {
                    numberEl.textContent = count;
                } else {
                    clearInterval(countdownInterval);
                    testState.isTransitioning = false;
                    startMainTest();
                }
            }, 1000);
        }

        // ==================== ÖRNEK BÖLÜMÜ ====================
        function startExampleSection() {
            stopCurrentAudio(); // Önceki sesi durdur
            testState.currentExampleIndex = 1; // İlk soru program tarafından gösterildi
            testState.exampleCorrectCount = 0;
            showExampleQuestion();
        }

        function showExampleQuestion() {
            if (testState.currentExampleIndex >= 4) { // 2, 3, 4. sorular = 3 soru
                evaluateExampleResults();
                return;
            }
            
            showScreen('exampleScreen');
            
            const example = testData.examples[testState.currentExampleIndex];
            const basePath = `./${example.folder}`;
            
            // Soru görselini göster
            document.getElementById('exampleQuestionImg').src = 
                `${basePath}/soru.png`;
            
            // Seçenekleri göster
            document.getElementById('exampleOptions').innerHTML = 
                generateOptions(basePath, 'example');
            
            // Debounced event listener'ları ekle
            const options = document.querySelectorAll('#exampleOptions .option');
            options.forEach(option => {
                const optionIndex = parseInt(option.dataset.optionIndex);
                const optionType = option.dataset.optionType;
                
                const debouncedHandler = debounce((e) => {
                    selectAnswer(optionType, optionIndex);
                }, 300);
                
                option.addEventListener('click', debouncedHandler);
                option.style.pointerEvents = 'auto';
                option.classList.remove('disabled');
            });
            
            testState.questionStartTime = Date.now();
        }

        function generateOptions(basePath, type) {
            let html = '';
            const letters = ['A', 'B', 'C', 'D', 'E'];
            
            // 5 seçenek için
            for (let i = 1; i <= 5; i++) {
                html += `
                    <div class="option" data-option-index="${i-1}" data-option-type="${type}">
                        <div class="option-label">${letters[i-1]}</div>
                        <img src="${basePath}/${i}.png" alt="Seçenek ${i}">
                    </div>
                `;
            }
            
            return html;
        }

        function selectAnswer(type, selectedIndex) {
            // Çift tıklama önleme - state locked ise işlemi reddet
            if (!safeLock()) {
                console.warn('Answer selection ignored - state locked');
                return;
            }

            try {
                const responseTime = (Date.now() - testState.questionStartTime) / 1000;
                
                if (type === 'example') {
                    const example = testData.examples[testState.currentExampleIndex];
                    const isCorrect = selectedIndex === example.correctAnswer;
                    
                    if (isCorrect) {
                        testState.exampleCorrectCount++;
                    }
                    
                    // Tüm seçenekleri disable et
                    const options = document.querySelectorAll('#exampleOptions .option');
                    options.forEach((option, index) => {
                        option.classList.add('disabled');
                        option.style.pointerEvents = 'none';
                        option.onclick = null;
                        // Event listener'ları temizle
                        option.replaceWith(option.cloneNode(true));
                        
                        if (index === selectedIndex) {
                            const newOption = document.querySelectorAll('#exampleOptions .option')[index];
                            newOption.classList.add('selected');
                        }
                    });
                    
                    setTimeout(() => {
                        unlockState();
                        testState.currentExampleIndex++;
                        showExampleQuestion();
                    }, 1000);
                    
                } else if (type === 'main') {
                    const question = testData.mainQuestions[testState.currentQuestionIndex];
                    const isCorrect = selectedIndex === question.correctAnswer;
                    
                    // Cevabı kaydet
                    testState.answers.push({
                        questionNo: testState.currentQuestionIndex + 1,
                        section: question.section,
                        selectedAnswer: selectedIndex,
                        correctAnswer: question.correctAnswer,
                        isCorrect: isCorrect,
                        responseTime: responseTime,
                        timestamp: Date.now()
                    });
                    
                    // Bölüm sonuçlarını güncelle
                    if (isCorrect) {
                        testState.sectionResults[question.section].correct++;
                    }
                    
                    // Tüm seçenekleri disable et
                    const options = document.querySelectorAll('#mainOptions .option');
                    options.forEach((option, index) => {
                        option.classList.add('disabled');
                        option.style.pointerEvents = 'none';
                        option.onclick = null;
                        // Event listener'ları temizle
                        option.replaceWith(option.cloneNode(true));
                        
                        if (index === selectedIndex) {
                            const newOption = document.querySelectorAll('#mainOptions .option')[index];
                            newOption.classList.add('selected');
                        }
                    });
                    
                    setTimeout(() => {
                        unlockState();
                        testState.currentQuestionIndex++;
                        showMainQuestion();
                    }, 1000);
                }
            } catch (e) {
                console.error('Select answer error:', e);
                unlockState(); // Hata durumunda unlock et
                handleError(`Cevap seçimi hatası: ${e.message}`, false);
            }
        }

        function evaluateExampleResults() {
            if (testState.exampleCorrectCount >= 2) { // 3 sorudan 2 doğru
                stopCurrentAudio(); // Önceki sesi durdur
                showScreen('exampleCompleteScreen');
                playAudio(testData.audioFiles.exampleComplete, () => {
                    showButton('exampleCompleteBtn');
                });
            } else {
                testState.exampleAttempts++;
                showScreen('exampleFailScreen');
            }
        }

        function goToMainTestIntro() {
            stopCurrentAudio(); // Önceki sesi durdur
            showScreen('mainTestIntroScreen');
            playAudio(testData.audioFiles.mainTestIntro, () => {
                showButton('mainTestStartBtn');
            });
        }

        // ==================== ANA TEST ====================
        function startMainTest() {
            stopCurrentAudio(); // Önceki sesi durdur
            testState.currentQuestionIndex = 0;
            testState.testStartTime = Date.now();
            testState.sectionStartTimes[1] = Date.now();
            testState.answers = [];
            
            // Progress bar'ı sıfırla ve timer'ı başlat
            const progressBar = document.getElementById('timeProgressFill');
            progressBar.classList.remove('animating');
            progressBar.style.width = '0%';
            
            // Bir sonraki frame'de animasyonu başlat (reflow için)
            requestAnimationFrame(() => {
                startTestTimer();
            });
            
            showMainQuestion();
        }

        function showMainQuestion() {
            if (testState.currentQuestionIndex >= testData.mainQuestions.length) {
                endTest();
                return;
            }
            
            showScreen('mainTestScreen');
            
            const question = testData.mainQuestions[testState.currentQuestionIndex];
            const currentSection = question.section;
            
            // Yeni bölüme geçiş kontrolü
            const prevQuestion = testState.currentQuestionIndex > 0 ? 
                testData.mainQuestions[testState.currentQuestionIndex - 1] : null;
            
            if (prevQuestion && prevQuestion.section !== currentSection) {
                // Önceki bölümün süresini kaydet
                testState.sectionResults[prevQuestion.section].time = 
                    (Date.now() - testState.sectionStartTimes[prevQuestion.section]) / 1000;
                
                // Yeni bölümün başlangıç zamanını kaydet
                testState.sectionStartTimes[currentSection] = Date.now();
            }
            
            // Progress bar artık otomatik animasyonla ilerliyor
            
            const basePath = `./${question.folder}`;
            
            // Soru görselini göster - artık hepsi standart
            const questionImgSrc = `${basePath}/soru.png`;
            
            document.getElementById('mainQuestionImg').src = questionImgSrc;
            document.getElementById('mainQuestionImg').onerror = function() {
                this.src = './placeholder-pattern.png'; // Placeholder görsel
            };
            
            // Seçenekleri göster
            document.getElementById('mainOptions').innerHTML = 
                generateMainOptions(basePath);
            
            // Debounced event listener'ları ekle
            const options = document.querySelectorAll('#mainOptions .option');
            options.forEach(option => {
                const optionIndex = parseInt(option.dataset.optionIndex);
                const optionType = option.dataset.optionType;
                
                const debouncedHandler = debounce((e) => {
                    selectAnswer(optionType, optionIndex);
                }, 300);
                
                option.addEventListener('click', debouncedHandler);
                option.style.pointerEvents = 'auto';
                option.classList.remove('disabled');
            });
            
            testState.questionStartTime = Date.now();
        }

        function generateMainOptions(basePath) {
            let html = '';
            const letters = ['A', 'B', 'C', 'D', 'E', 'F'];
            
            // 4-ALTILI KARE FORMAT klasörleri 6 seçenekli
            const is6Option = basePath.includes('4-ALTILI KARE FORMAT');
            const optionCount = is6Option ? 6 : 5;
            
            for (let i = 1; i <= optionCount; i++) {
                html += `
                    <div class="option" data-option-index="${i-1}" data-option-type="main">
                        <div class="option-label">${letters[i-1]}</div>
                        <img src="${basePath}/${i}.png" 
                             alt="Seçenek ${i}"
                             onerror="console.error('Görsel yüklenemedi: ${basePath}/${i}.png'); this.style.background='#f0f0f0'; this.style.border='2px dashed #ccc';">
                    </div>
                `;
            }
            
            return html;
        }

        function updateProgressBar() {
            // Bu fonksiyon artık kullanılmıyor - progress bar otomatik animasyonla ilerliyor
        }

        // Timer fonksiyonları
        function startTestTimer() {
            // Progress bar animasyonunu başlat
            const progressBar = document.getElementById('timeProgressFill');
            progressBar.classList.add('animating');
            
            // 5 dakika sonra testi bitir
            testState.timerInterval = setTimeout(() => {
                endTest();
            }, 300000); // 5 dakika = 300000 ms
        }

        // ==================== TEST SONU VE RAPORLAMA ====================
        function endTest() {
            stopCurrentAudio(); // Test bitince önceki sesi durdur
            
            // State'i temizle
            unlockState();
            testState.isTransitioning = false;
            
            if (testState.timerInterval) {
                clearTimeout(testState.timerInterval);
            }
            
            const endTime = Date.now();
            const totalTime = Math.round((endTime - testState.testStartTime) / 1000);
            
            // Son bölümün süresini kaydet
            const lastQuestion = testData.mainQuestions[testState.currentQuestionIndex - 1];
            if (lastQuestion) {
                testState.sectionResults[lastQuestion.section].time = 
                    (endTime - testState.sectionStartTimes[lastQuestion.section]) / 1000;
            }
            
            // Hesaplamalar
            const totalQuestions = 23;
            const answeredQuestions = testState.answers.length;
            const correctAnswers = testState.answers.filter(a => a.isCorrect).length;
            const wrongAnswers = answeredQuestions - correctAnswers;
            const unansweredQuestions = totalQuestions - answeredQuestions;
            const successRate = answeredQuestions > 0 ? 
                Math.round((correctAnswers / answeredQuestions) * 100) : 0;
            
            // İşlem hızı hesaplama
            const totalResponseTime = testState.answers.reduce((sum, answer) => sum + answer.responseTime, 0);
            const avgResponseTime = answeredQuestions > 0 ? totalResponseTime / answeredQuestions : 0;
            const speedScore = Math.round(((300 - totalTime) / 300) * 100); // Max 5 dakika
            
            // Dürtüsellik analizi
            const fastWrongAnswers = testState.answers.filter(a => !a.isCorrect && a.responseTime < 2).length;
            const impulsivityWarning = fastWrongAnswers > 3;
            
            // Sonuç ekranını göster
            showScreen('resultsScreen');
            
            // Test bitiş sesini çal (biraz gecikmeyle)
            setTimeout(() => {
                console.log('Test bitti, ses dosyası çalınacak:', testData.audioFiles.testComplete);
                playAudio(testData.audioFiles.testComplete);
            }, 500);
            
            // Veritabanına kaydet
            saveTestResults({
                totalTime,
                totalQuestions,
                answeredQuestions,
                correctAnswers,
                wrongAnswers,
                unansweredQuestions,
                successRate,
                speedScore,
                avgResponseTime,
                totalResponseTime,
                sectionResults: testState.sectionResults,
                detailedAnswers: testState.answers,
                exampleAttempts: testState.exampleAttempts,
                exampleCorrectCount: testState.exampleCorrectCount,
                impulsivityWarning,
                lastQuestionReached: testState.currentQuestionIndex
            });
        }

        // ==================== VERİTABANI KAYIT ====================
        async function saveTestResults(results) {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                
                const payload = {
                    testType: 'Akil_Mantik_Testi',
                    learnworlds_user_id: urlParams.get('user_id'),
                    learnworlds_user_email: urlParams.get('user_email'),
                    learnworlds_user_name: urlParams.get('user_name'),
                    course_id: urlParams.get('course_id'),
                    lesson_id: urlParams.get('lesson_id'),
                    
                    // Test zamanları
                    test_start_time: testState.testStartTime,
                    test_end_time: Date.now(),
                    test_elapsed_time_seconds: results.totalTime,
                    
                    // Genel sonuçlar
                    total_questions: results.totalQuestions,
                    answered_questions: results.answeredQuestions,
                    correct_answers: results.correctAnswers,
                    wrong_answers: results.wrongAnswers,
                    unanswered_questions: results.unansweredQuestions,
                    success_rate: results.successRate,
                    
                    // İşlem hızı
                    speed_score: results.speedScore,
                    avg_response_time: results.avgResponseTime,
                    total_response_time: results.totalResponseTime,
                    
                    // Bölüm bazlı analiz
                    section_results: results.sectionResults,
                    
                    // Detaylı cevaplar
                    detailed_answers: results.detailedAnswers,
                    
                    // Örnek test sonuçları
                    example_attempts: results.exampleAttempts,
                    example_correct_count: results.exampleCorrectCount,
                    
                    // Ek analizler
                    impulsivity_warning: results.impulsivityWarning,
                    last_question_reached: results.lastQuestionReached
                };
                
                const response = await fetch('/api/fortest-akil-mantik-sonuclari', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('✅ Test sonuçları başarıyla kaydedildi:', result.submissionId);
                    showNotification('Test sonuçlarınız başarıyla kaydedildi!', 'success');
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('❌ Test sonuçları kaydedilemedi:', error);
                showNotification('Test sonuçları kaydedilirken bir hata oluştu.', 'error');
            }
        }

        // Örnek uygulama tekrar fonksiyonu
        function retryExampleFromFail() {
            console.log('🔄 Örnek uygulama tekrar edilecek...');
            
            // State'i unlock et
            unlockState();
            testState.isTransitioning = false;
            
            // Tüm ses ve timer'ları temizle
            stopCurrentAudio();
            if (testState.timerInterval) {
                clearTimeout(testState.timerInterval);
                testState.timerInterval = null;
            }
            
            // Örnek test durumlarını sıfırla
            testState.currentExampleIndex = 0;
            testState.exampleCorrectCount = 0;
            testState.exampleAttempts = Math.max(0, testState.exampleAttempts); // Sayacı koruyoruz
            
            // Demo ekranındaki butonları temizle
            const demoOptions = document.querySelectorAll('#demoOptions .option');
            demoOptions.forEach(option => {
                option.classList.remove('selected', 'correct');
                option.style.transition = '';
                option.style.border = '';
                option.style.transform = '';
                option.style.boxShadow = '';
            });
            
            // Mouse pointer'ı temizle
            const pointer = document.getElementById('demoPointer');
            const clickEffect = document.getElementById('clickEffect');
            if (pointer) {
                pointer.style.opacity = '0';
                pointer.style.transition = '';
                pointer.style.left = '';
                pointer.style.top = '';
            }
            if (clickEffect) {
                clickEffect.classList.remove('active');
                clickEffect.style.left = '';
                clickEffect.style.top = '';
            }
            
            // Demo butonunu gizle
            const demoBtn = document.getElementById('demoNextBtn');
            if (demoBtn) {
                demoBtn.style.display = 'none';
                demoBtn.classList.remove('visible');
            }
            
            // Örnek sorular ekranındaki butonları da temizle
            const exampleOptions = document.querySelectorAll('#exampleOptions .option');
            exampleOptions.forEach(option => {
                option.classList.remove('selected', 'correct', 'wrong');
                option.style.transition = '';
                option.style.border = '';
                option.style.transform = '';
                option.style.boxShadow = '';
            });
            
            // Örnek demo ekranına geri dön
            goToExampleDemo();
        }

        function completeTest() {
            // State'i temizle
            unlockState();
            testState.isTransitioning = false;
            
            // Sesi durdur
            stopCurrentAudio();
            
            // Loading göster
            showLoading('Sıradaki teste geçiliyor...', 0);
            
            // Sıradaki bölüme yönlendirme yapılabilir
            console.log('Test tamamlandı, sıradaki bölüme geçiliyor...');
            
            // React parent'a test tamamlandığını bildir
            if (window.parent !== window) {
                try {
                    const savedResults = localStorage.getItem('akilMantikTestResults');
                    window.parent.postMessage({
                        type: 'test-complete',
                        testName: 'akil-mantik',
                        results: savedResults ? JSON.parse(savedResults) : {},
                        timestamp: new Date().toISOString()
                    }, window.location.origin);
                } catch (e) {
                    console.error('Parent message failed:', e);
                }
            }
        }

        // ==================== YARDIMCI FONKSİYONLAR ====================
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ==================== CLEANUP & EVENT LISTENERS ====================
        window.addEventListener('beforeunload', function(e) {
            try {
                // Eğer test devam ediyorsa uyar
                if (testState.testStartTime && testState.currentQuestionIndex < testData.mainQuestions.length) {
                    // Kullanıcıya uyarı (modern tarayıcılarda generic mesaj çıkar)
                    const confirmationMessage = 'Akıl ve mantık testi devam ediyor! Sayfayı kapatırsanız test verileri kaybolabilir.';
                    e.returnValue = confirmationMessage; // Chrome
                    return confirmationMessage; // Firefox
                }
                
                stopCurrentAudio();
                if (testState.timerInterval) {
                    clearTimeout(testState.timerInterval);
                }
                // State'i temizle
                unlockState();
                testState.isTransitioning = false;
                console.log('Normal cleanup completed');
            } catch (e) {
                console.error('Beforeunload error:', e);
            }
        });

        // Visibility change - pause/resume
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Sayfa gizlenince (tab değişimi, minimize, etc.)
                if (testState.currentAudio) {
                    testState.currentAudio.pause();
                }
                console.log('📱 Sayfa gizlendi');
            } else {
                // Sayfa tekrar görünür olunca
                if (testState.currentAudio && testState.currentAudio.paused) {
                    testState.currentAudio.play().catch(e => {
                        console.warn('Resume audio failed:', e);
                    });
                }
                console.log('📱 Sayfa tekrar aktif');
            }
        });

        // Klavye kısayolları
        document.addEventListener('keydown', function(e) {
            // ESC tuşu ile hata overlay'ini kapat
            if (e.key === 'Escape') {
                const errorOverlay = document.getElementById('errorOverlay');
                if (errorOverlay && errorOverlay.classList.contains('show')) {
                    errorOverlay.classList.remove('show');
                }
            }
            
            // Spacebar ile ses durdurma (debug için)
            if (e.key === ' ' && e.ctrlKey) {
                e.preventDefault();
                stopCurrentAudio();
                console.log('🔇 Ses manuel olarak durduruldu');
            }
            
            // Ctrl+R ile state temizleme (debug için)
            if (e.key === 'r' && e.ctrlKey) {
                unlockState();
                testState.isTransitioning = false;
                console.log('🔄 State temizlendi');
            }
        });

        // Global fonksiyonları expose et
        window.retryExampleFromFail = retryExampleFromFail;
        window.showExampleCountdown = showExampleCountdown;
        window.showMainCountdown = showMainCountdown;

        // Sayfa yüklendi
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Akıl ve Mantık Testi başlatılıyor...');
            console.log('📱 Cihaz:', navigator.userAgent);
            console.log('🖥️ Ekran:', window.innerWidth + 'x' + window.innerHeight);
        });
    </script>
</body>
</html> 